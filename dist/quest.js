import { engine, Material, MeshRenderer, TextShape, Transform } from '@dcl/sdk/ecs';
import { Color4, Vector3 } from '@dcl/sdk/math';
import { getPlayer } from "@dcl/sdk/players";
import { getRealm } from '~system/Runtime';
import { Client } from 'colyseus.js';
import mitt from 'mitt';
import './polyfill';
export var LSCQUEST_EVENTS;
(function (LSCQUEST_EVENTS) {
    LSCQUEST_EVENTS["QUEST_CONNECTION"] = "QUEST_CONNECTION";
    LSCQUEST_EVENTS["QUEST_ERROR"] = "QUEST_ERROR";
    LSCQUEST_EVENTS["QUEST_DATA"] = "QUEST_DATA";
    LSCQUEST_EVENTS["QUEST_STARTED"] = "QUEST_STARTED";
    LSCQUEST_EVENTS["QUEST_COMPLETE"] = "QUEST_COMPLETE";
    LSCQUEST_EVENTS["QUEST_END"] = "QUEST_END";
    LSCQUEST_EVENTS["QUEST_UPDATE"] = "QUEST_UPDATE";
    LSCQUEST_EVENTS["QUEST_DISCONNECT"] = "QUEST_DISCONNECT";
    LSCQUEST_EVENTS["QUEST_ACTION"] = "QUEST_ACTION";
    LSCQUEST_EVENTS["QUEST_START"] = "QUEST_START";
    LSCQUEST_EVENTS["QUEST_STEP_COMPLETE"] = "STEP_COMPLETE";
    LSCQUEST_EVENTS["QUEST_TASK_COMPLETE"] = "TASK_COMPLETE";
})(LSCQUEST_EVENTS || (LSCQUEST_EVENTS = {}));
const DEBUG = false;
let LOCAL_CREATOR = false;
let player;
let pendingQuestConnections = [];
export const lscQuestEvent = mitt();
export const lscQuestConnections = new Map();
export const lscQuestUserData = new Map();
export async function LSCQuestLocalCreator(value) {
    LOCAL_CREATOR = value;
}
export async function LSCQuestConnect(questId) {
    console.log('connecting to quest', questId);
    engine.addSystem(CheckPlayerSystem);
    engine.addSystem(ConnectQuestSystem);
    if (lscQuestConnections.has(questId))
        return;
    pendingQuestConnections.push(questId);
}
export function LSCQuestStart(questId) {
    let questConnection = lscQuestConnections.get(questId);
    if (!questConnection)
        return;
    try {
        questConnection.send(LSCQUEST_EVENTS.QUEST_START, { questId });
    }
    catch (e) {
        console.log('error sending quest action', e);
    }
}
export function LSCQuestAction(questId, stepId, taskId) {
    let questConnection = lscQuestConnections.get(questId);
    if (!questConnection)
        return;
    try {
        questConnection.send(LSCQUEST_EVENTS.QUEST_ACTION, { questId, stepId, taskId, metaverse: "DECENTRALAND" });
    }
    catch (e) {
        console.log('error sending quest action', e);
    }
}
function setLSCQuestListeners(room, userId) {
    room.onMessage(LSCQUEST_EVENTS.QUEST_CONNECTION, (info) => {
        console.log('quest connection ', info);
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_CONNECTION, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_ERROR, (info) => {
        console.log('quest error ', info);
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_ERROR, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_DATA, (info) => {
        console.log('user quest data ', info);
        if (info.userQuestInfo) {
            lscQuestUserData.set(info.questId, info.userQuestInfo);
        }
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_DATA, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_STARTED, (info) => {
        console.log('started quest ', info);
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_STARTED, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_COMPLETE, (info) => {
        console.log('complete quest ', info);
        if (info.userQuestInfo) {
            lscQuestUserData.set(info.questId, info.userQuestInfo);
        }
        else {
            let userQuestData = lscQuestUserData.get(info.questId);
            if (userQuestData) {
                userQuestData.completed = true;
            }
        }
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_COMPLETE, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_END, (info) => {
        console.log('ended quest ', info);
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_END, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_UPDATE, (info) => {
        console.log('update quest ', info);
        lscQuestUserData.set(userId, info);
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_UPDATE, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_STEP_COMPLETE, (info) => {
        console.log('step complete quest ', info);
        if (info.userQuestInfo) {
            lscQuestUserData.set(info.questId, info.userQuestInfo);
        }
        else {
            let userQuestData = lscQuestUserData.get(info.questId);
            if (userQuestData) {
                let step = userQuestData.steps.find((step) => step.stepId === info.stepId);
                if (step) {
                    step.completed = true;
                }
            }
        }
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_STEP_COMPLETE, info);
    });
    room.onMessage(LSCQUEST_EVENTS.QUEST_TASK_COMPLETE, (info) => {
        console.log('task complete quest ', info);
        if (info.userQuestInfo) {
            lscQuestUserData.set(info.questId, info.userQuestInfo);
        }
        else {
            let userQuestData = lscQuestUserData.get(info.questId);
            if (userQuestData) {
                let step = userQuestData.steps.find((step) => step.stepId === info.stepId);
                if (step) {
                    let task = step.tasks.find((task) => task.taskId === info.taskId);
                    if (task) {
                        task.count++;
                        task.completed = true;
                    }
                }
            }
        }
        lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_TASK_COMPLETE, info);
    });
}
let time = 0;
function CheckPlayerSystem(dt) {
    if (time > 0) {
        time -= dt;
    }
    else {
        player = getPlayer();
        if (!player) {
            time = 1;
        }
        else {
            engine.removeSystem(CheckPlayerSystem);
        }
    }
}
function ConnectQuestSystem() {
    if (!player)
        return;
    if (pendingQuestConnections.length > 0) {
        let pendingQuestId = "" + pendingQuestConnections.shift();
        makeQuestConnection(pendingQuestId);
    }
}
async function makeQuestConnection(questId) {
    const realm = await getRealm({});
    const options = {
        userId: player.userId,
        name: player.name,
        realm: LOCAL_CREATOR ? "local-testing" : realm.realmInfo?.baseUrl,
        questId: questId,
    };
    let client = new Client(DEBUG ?
        { hostname: 'localhost', secure: false, port: 5353 } :
        { hostname: 'angzaar-plaza.dcl-iwb.co', pathname: '/ws', secure: true });
    try {
        const room = await client.joinOrCreate('angzaar_questing', options);
        lscQuestConnections.set(questId, room);
        setLSCQuestListeners(room, player.userId);
        room.onLeave((code, reason) => {
            console.log('left quest room', questId, code, reason);
            lscQuestEvent.emit(LSCQUEST_EVENTS.QUEST_DISCONNECT, { questId, code, reason });
        });
        return room;
    }
    catch (error) {
        console.error('Error connecting to LSC Quest System', error);
        throw error;
    }
}
export function LSCQuestLeaderboard(questId, transform, updateInterval, limit, order = 'asc', sortBy = 'elapsedTime', completed = true, showBackground = true, title = "Leaderboard") {
    let leaderboard = engine.addEntity();
    Transform.create(leaderboard, transform);
    const rowWidth = 3;
    const rowHeight = 0.4;
    function formatScoreType(type) {
        if (type === 'elapsedTime')
            return 'Time';
        return type.charAt(0).toUpperCase() + type.slice(1);
    }
    const titleEntity = engine.addEntity();
    Transform.create(titleEntity, {
        parent: leaderboard,
        position: Vector3.create(0, 0.6, 0)
    });
    TextShape.create(titleEntity, {
        text: title,
        fontSize: 2.5,
        textAlign: 4
    });
    const leftPos = -1.2;
    const centerPos = 0;
    const rightPos = 1.2;
    const headerEntity = engine.addEntity();
    Transform.create(headerEntity, {
        parent: leaderboard,
        position: Vector3.create(0, 0.2, 0)
    });
    const headerBgEntity = engine.addEntity();
    Transform.create(headerBgEntity, {
        parent: headerEntity,
        position: Vector3.create(0, 0, 0.03),
        scale: Vector3.create(rowWidth, rowHeight, 1)
    });
    MeshRenderer.setPlane(headerBgEntity);
    Material.setPbrMaterial(headerBgEntity, {
        albedoColor: Color4.create(0 / 255, 255 / 255, 213 / 255, 1)
    });
    const rankHeaderEntity = engine.addEntity();
    Transform.create(rankHeaderEntity, {
        parent: headerEntity,
        position: Vector3.create(leftPos, 0, 0.02)
    });
    TextShape.create(rankHeaderEntity, {
        text: "Rank",
        fontSize: 1.5,
        textAlign: 4
    });
    const nameHeaderEntity = engine.addEntity();
    Transform.create(nameHeaderEntity, {
        parent: headerEntity,
        position: Vector3.create(centerPos - 0.4, 0, 0.02)
    });
    TextShape.create(nameHeaderEntity, {
        text: "Player",
        fontSize: 1.5,
        textAlign: 3
    });
    const scoreHeaderEntity = engine.addEntity();
    Transform.create(scoreHeaderEntity, {
        parent: headerEntity,
        position: Vector3.create(rightPos, 0, 0.02)
    });
    TextShape.create(scoreHeaderEntity, {
        text: formatScoreType(sortBy),
        fontSize: 1.5,
        textAlign: 4
    });
    const leaderboardRows = [];
    for (let i = 0; i < limit; i++) {
        const rowEntity = engine.addEntity();
        Transform.create(rowEntity, {
            parent: leaderboard,
            position: Vector3.create(0, -i * 0.5 - 0.2, 0)
        });
        const backgroundEntity = engine.addEntity();
        if (showBackground) {
            Transform.create(backgroundEntity, {
                parent: rowEntity,
                position: Vector3.create(0, 0, 0.01),
                scale: Vector3.create(rowWidth, rowHeight, 1)
            });
            MeshRenderer.setPlane(backgroundEntity);
            Material.setPbrMaterial(backgroundEntity, {
                albedoColor: i % 2 === 0 ?
                    Color4.create(18 / 255, 23 / 255, 37 / 255, 1) :
                    Color4.create(26 / 255, 34 / 255, 53 / 255, 1)
            });
        }
        else {
            Transform.create(backgroundEntity, {
                parent: rowEntity,
                scale: Vector3.Zero()
            });
        }
        const rankEntity = engine.addEntity();
        Transform.create(rankEntity, {
            parent: rowEntity,
            position: Vector3.create(leftPos, 0, 0)
        });
        TextShape.create(rankEntity, { text: `#${i + 1}`, fontSize: 1.5 });
        const profileEntity = engine.addEntity();
        Transform.create(profileEntity, {
            parent: rowEntity,
            position: Vector3.create(centerPos - 0.8, 0, 0),
            scale: Vector3.create(0.3, 0.3, 0.3)
        });
        MeshRenderer.setPlane(profileEntity);
        Material.setPbrMaterial(profileEntity, {
            texture: Material.Texture.Avatar({
                userId: '',
            }),
        });
        const nameEntity = engine.addEntity();
        Transform.create(nameEntity, {
            parent: rowEntity,
            position: Vector3.create(centerPos - 0.4, 0, 0)
        });
        TextShape.create(nameEntity, { text: `Name`, fontSize: 1.5, textAlign: 3 });
        const scoreEntity = engine.addEntity();
        Transform.create(scoreEntity, {
            parent: rowEntity,
            position: Vector3.create(rightPos, 0, 0)
        });
        TextShape.create(scoreEntity, { text: `Score`, fontSize: 1.5 });
        leaderboardRows.push({
            rank: i + 1,
            rowEntity,
            backgroundEntity,
            rankEntity,
            profileEntity,
            nameEntity,
            scoreEntity
        });
    }
    let time = 0;
    function leaderboardUpdate(dt) {
        if (time > 0) {
            time -= dt;
        }
        else {
            time = updateInterval;
            updateLSCQuestLeaderboard();
        }
    }
    async function updateLSCQuestLeaderboard() {
        try {
            const playerData = getPlayer();
            const playerID = playerData ? playerData.userId : '';
            const playerName = playerData?.name || 'You';
            let params = [`completed=${completed}`, `order=${order}`, `limit=${limit}`, `sortBy=${sortBy}`];
            let response = await fetch(`http://localhost:5353/api/quests/${questId}/users?` + params.join('&'));
            let data = await response.json();
            for (let i = 0; i < leaderboardRows.length; i++) {
                const row = leaderboardRows[i];
                const rowData = data[i];
                if (rowData) {
                    if (!Transform.has(row.rowEntity))
                        continue;
                    Transform.getMutable(row.rowEntity).scale = Vector3.create(1, 1, 1);
                    if (showBackground) {
                        Transform.getMutable(row.backgroundEntity).scale = Vector3.create(rowWidth, rowHeight, 1);
                    }
                    const rankText = `#${i + 1}`;
                    TextShape.getMutable(row.rankEntity).text = rankText;
                    Material.setPbrMaterial(row.profileEntity, {
                        texture: Material.Texture.Avatar({
                            userId: rowData.userId,
                        }),
                    });
                    const name = rowData.name || 'Anonymous';
                    TextShape.getMutable(row.nameEntity).text = name;
                    let scoreText = '';
                    if (sortBy === 'elapsedTime') {
                        const ms = rowData.elapsedTime * 1000;
                        const seconds = Math.floor(ms / 1000);
                        const minutes = Math.floor(seconds / 60);
                        const hours = Math.floor(minutes / 60);
                        if (hours > 0) {
                            scoreText = `${hours}h ${minutes % 60}m`;
                        }
                        else if (minutes > 0) {
                            scoreText = `${minutes}m ${seconds % 60}s`;
                        }
                        else {
                            scoreText = `${seconds}s`;
                        }
                    }
                    else {
                        scoreText = rowData[sortBy]?.toString() || '0';
                    }
                    TextShape.getMutable(row.scoreEntity).text = scoreText;
                }
                else {
                    if (Transform.has(row.rowEntity)) {
                        Transform.getMutable(row.rowEntity).scale = Vector3.Zero();
                        if (showBackground) {
                            Transform.getMutable(row.backgroundEntity).scale = Vector3.Zero();
                        }
                    }
                }
            }
        }
        catch (e) {
            console.log('error updating quest leaderboard', e);
        }
    }
    engine.addSystem(leaderboardUpdate);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcXVlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBVSxRQUFRLEVBQUUsWUFBWSxFQUFpQixTQUFTLEVBQUUsU0FBUyxFQUFpQixNQUFNLGNBQWMsQ0FBQTtBQUV6SCxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUMvQyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFBO0FBQzFDLE9BQU8sRUFBRSxNQUFNLEVBQVEsTUFBTSxhQUFhLENBQUE7QUFDMUMsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFBO0FBQ3ZCLE9BQU8sWUFBWSxDQUFBO0FBRW5CLE1BQU0sQ0FBTixJQUFZLGVBYVg7QUFiRCxXQUFZLGVBQWU7SUFDekIsd0RBQXFDLENBQUE7SUFDckMsOENBQTJCLENBQUE7SUFDM0IsNENBQXlCLENBQUE7SUFDekIsa0RBQStCLENBQUE7SUFDL0Isb0RBQWlDLENBQUE7SUFDakMsMENBQXVCLENBQUE7SUFDdkIsZ0RBQTZCLENBQUE7SUFDN0Isd0RBQXFDLENBQUE7SUFDckMsZ0RBQTZCLENBQUE7SUFDN0IsOENBQTJCLENBQUE7SUFDM0Isd0RBQXFDLENBQUE7SUFDckMsd0RBQXFDLENBQUE7QUFDdkMsQ0FBQyxFQWJXLGVBQWUsS0FBZixlQUFlLFFBYTFCO0FBa0NELE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQTtBQUNuQixJQUFJLGFBQWEsR0FBRyxLQUFLLENBQUE7QUFFekIsSUFBSSxNQUFVLENBQUE7QUFDZCxJQUFJLHVCQUF1QixHQUFZLEVBQUUsQ0FBQTtBQUV6QyxNQUFNLENBQUMsTUFBTSxhQUFhLEdBQUcsSUFBSSxFQUFFLENBQUE7QUFDbkMsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcs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QUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO3dCQUNqQyxTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFBO3dCQUcxRCxJQUFJLGNBQWMsRUFBRSxDQUFDOzRCQUNuQixTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7d0JBQ25FLENBQUM7b0JBQ0gsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFNLENBQUssRUFBRSxDQUFDO1lBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUNwRCxDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtBQUdyQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZW5naW5lLCBFbnRpdHksIE1hdGVyaWFsLCBNZXNoUmVuZGVyZXIsIFRleHRBbGlnbk1vZGUsIFRleHRTaGFwZSwgVHJhbnNmb3JtLCBUcmFuc2Zvcm1UeXBlIH0gZnJvbSAnQGRjbC9zZGsvZWNzJ1xuaW1wb3J0IHsgUmVhY3RFY3NSZW5kZXJlcn0gZnJvbSAnQGRjbC9zZGsvcmVhY3QtZWNzJ1xuaW1wb3J0IHsgQ29sb3I0LCBWZWN0b3IzIH0gZnJvbSAnQGRjbC9zZGsvbWF0aCdcbmltcG9ydCB7Z2V0UGxheWVyfSBmcm9tIFwiQGRjbC9zZGsvcGxheWVyc1wiO1xuaW1wb3J0IHsgZ2V0UmVhbG0gfSBmcm9tICd+c3lzdGVtL1J1bnRpbWUnXG5pbXBvcnQgeyBDbGllbnQsIFJvb20gfSBmcm9tICdjb2x5c2V1cy5qcydcbmltcG9ydCBtaXR0IGZyb20gJ21pdHQnXG5pbXBvcnQgJy4vcG9seWZpbGwnXG5cbmV4cG9ydCBlbnVtIExTQ1FVRVNUX0VWRU5UUyB7XG4gIFFVRVNUX0NPTk5FQ1RJT04gPSAnUVVFU1RfQ09OTkVDVElPTicsXG4gIFFVRVNUX0VSUk9SID0gJ1FVRVNUX0VSUk9SJyxcbiAgUVVFU1RfREFUQSA9ICdRVUVTVF9EQVRBJyxcbiAgUVVFU1RfU1RBUlRFRCA9ICdRVUVTVF9TVEFSVEVEJyxcbiAgUVVFU1RfQ09NUExFVEUgPSAnUVVFU1RfQ09NUExFVEUnLFxuICBRVUVTVF9FTkQgPSAnUVVFU1RfRU5EJyxcbiAgUVVFU1RfVVBEQVRFID0gJ1FVRVNUX1VQREFURScsXG4gIFFVRVNUX0RJU0NPTk5FQ1QgPSAnUVVFU1RfRElTQ09OTkVDVCcsXG4gIFFVRVNUX0FDVElPTiA9ICdRVUVTVF9BQ1RJT04nLFxuICBRVUVTVF9TVEFSVCA9ICdRVUVTVF9TVEFSVCcsXG4gIFFVRVNUX1NURVBfQ09NUExFVEUgPSAnU1RFUF9DT01QTEVURScsXG4gIFFVRVNUX1RBU0tfQ09NUExFVEUgPSAnVEFTS19DT01QTEVURSdcbn1cblxuaW50ZXJmYWNlIFRhc2tEZWZpbml0aW9uIHtcbiAgdGFza0lkOiBzdHJpbmc7XG4gIHJlcXVpcmVkQ291bnQ6IG51bWJlcjtcbiAgY291bnQ6IG51bWJlcjtcbiAgY29tcGxldGVkOiBib29sZWFuO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBtZXRhdmVyc2U6ICdERUNFTlRSQUxBTkQnIHwgJ0hZUEVSRlknO1xuICBwcmVyZXF1aXNpdGVUYXNrSWRzOiBzdHJpbmdbXTtcbn1cbmludGVyZmFjZSBTdGVwRGVmaW5pdGlvbiB7XG4gIHN0ZXBJZDogc3RyaW5nO1xuICBuYW1lPzogc3RyaW5nO1xuICBjb21wbGV0ZWQ6IGJvb2xlYW47XG4gIHRhc2tzOiBUYXNrRGVmaW5pdGlvbltdO1xuICBwcmVyZXF1aXNpdGVTdGVwSWRzPzogc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBRdWVzdERlZmluaXRpb24ge1xuICAgIHF1ZXN0SWQ6IHN0cmluZztcbiAgICB2ZXJzaW9uOiBudW1iZXI7XG4gICAgZW5hYmxlZDpib29sZWFuLFxuICAgIHF1ZXN0VHlwZTogJ0xJTkVBUicgfCAnT1BFTl9FTkRFRCcgfCAnT05FX1NIT1QnOyBcbiAgICBzdGFydFRyaWdnZXI/OiAnRVhQTElDSVQnIHwgJ0ZJUlNUX1RBU0snO1xuICAgIHRpdGxlPzogc3RyaW5nO1xuICAgIHN0YXJ0VGltZT86IG51bWJlcjtcbiAgICBlbmRUaW1lPzogbnVtYmVyO1xuICAgIGFsbG93UmVwbGF5OiBib29sZWFuO1xuICAgIGNvbXBsZXRlZDogYm9vbGVhbjtcbiAgICBjcmVhdG9yOiBzdHJpbmc7XG4gICAgc3RlcHM6IFN0ZXBEZWZpbml0aW9uW107XG59XG5cbmNvbnN0IERFQlVHID0gZmFsc2VcbmxldCBMT0NBTF9DUkVBVE9SID0gZmFsc2VcblxubGV0IHBsYXllcjphbnlcbmxldCBwZW5kaW5nUXVlc3RDb25uZWN0aW9uczpzdHJpbmdbXSA9IFtdXG5cbmV4cG9ydCBjb25zdCBsc2NRdWVzdEV2ZW50ID0gbWl0dCgpXG5leHBvcnQgY29uc3QgbHNjUXVlc3RDb25uZWN0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBSb29tPigpXG5leHBvcnQgY29uc3QgbHNjUXVlc3RVc2VyRGF0YSA9IG5ldyBNYXA8c3RyaW5nLCBRdWVzdERlZmluaXRpb24+KClcblxuLyoqXG4gKiBTZXQgdGhlIGxvY2FsIGNyZWF0b3IgZm9yIHRlc3RpbmdcbiAqXG4gKiBAcGFyYW0gcXVlc3RJZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gTFNDUXVlc3RMb2NhbENyZWF0b3IodmFsdWU6Ym9vbGVhbikge1xuICBMT0NBTF9DUkVBVE9SID0gdmFsdWVcbn1cblxuLyoqXG4gKiBDb25uZWN0IHRvIGEgUXVlc3Qgd2l0aGluIHRoZSBMU0MgUXVlc3QgU3lzdGVtXG4gKlxuICogQHBhcmFtIHF1ZXN0SWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIExTQ1F1ZXN0Q29ubmVjdChxdWVzdElkOnN0cmluZykge1xuICBjb25zb2xlLmxvZygnY29ubmVjdGluZyB0byBxdWVzdCcsIHF1ZXN0SWQpXG4gIGVuZ2luZS5hZGRTeXN0ZW0oQ2hlY2tQbGF5ZXJTeXN0ZW0pXG4gIGVuZ2luZS5hZGRTeXN0ZW0oQ29ubmVjdFF1ZXN0U3lzdGVtKVxuXG4gIGlmKGxzY1F1ZXN0Q29ubmVjdGlvbnMuaGFzKHF1ZXN0SWQpKSAgcmV0dXJuXG4gIHBlbmRpbmdRdWVzdENvbm5lY3Rpb25zLnB1c2gocXVlc3RJZClcbn1cblxuLyoqXG4gKiBTdGFydCBhIHNwZWNpZmljIFF1ZXN0IGluIHRoZSBMU0MgUXVlc3QgU3lzdGVtXG4gKlxuICogQHBhcmFtIHF1ZXN0SWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIExTQ1F1ZXN0U3RhcnQocXVlc3RJZDpzdHJpbmcpe1xuICBsZXQgcXVlc3RDb25uZWN0aW9uID0gbHNjUXVlc3RDb25uZWN0aW9ucy5nZXQocXVlc3RJZClcbiAgaWYoIXF1ZXN0Q29ubmVjdGlvbikgIHJldHVyblxuXG4gIHRyeXtcbiAgICBxdWVzdENvbm5lY3Rpb24uc2VuZChMU0NRVUVTVF9FVkVOVFMuUVVFU1RfU1RBUlQsIHtxdWVzdElkfSlcbiAgfVxuICBjYXRjaChlOmFueSl7XG4gICAgY29uc29sZS5sb2coJ2Vycm9yIHNlbmRpbmcgcXVlc3QgYWN0aW9uJywgZSlcbiAgfVxufVxuXG4vKipcbiAqIFJ1biBhIFF1ZXN0IEFjdGlvbiB3aXRoaW4gdGhlIExTQyBRdWVzdCBTeXN0ZW1cbiAqXG4gKiBAcGFyYW0gcXVlc3RJZFxuICogQHBhcmFtIHN0ZXBJZFxuICogQHBhcmFtIHRhc2tJZFxuICovXG5leHBvcnQgZnVuY3Rpb24gTFNDUXVlc3RBY3Rpb24ocXVlc3RJZDpzdHJpbmcsIHN0ZXBJZDpzdHJpbmcsIHRhc2tJZDpzdHJpbmcpe1xuICBsZXQgcXVlc3RDb25uZWN0aW9uID0gbHNjUXVlc3RDb25uZWN0aW9ucy5nZXQocXVlc3RJZClcbiAgaWYoIXF1ZXN0Q29ubmVjdGlvbikgIHJldHVyblxuXG4gIHRyeXtcbiAgICBxdWVzdENvbm5lY3Rpb24uc2VuZChMU0NRVUVTVF9FVkVOVFMuUVVFU1RfQUNUSU9OLCB7cXVlc3RJZCwgc3RlcElkLCB0YXNrSWQsIG1ldGF2ZXJzZTpcIkRFQ0VOVFJBTEFORFwifSlcbiAgfVxuICBjYXRjaChlOmFueSl7XG4gICAgY29uc29sZS5sb2coJ2Vycm9yIHNlbmRpbmcgcXVlc3QgYWN0aW9uJywgZSlcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRMU0NRdWVzdExpc3RlbmVycyhyb29tOlJvb20sIHVzZXJJZDpzdHJpbmcpe1xuICByb29tLm9uTWVzc2FnZShMU0NRVUVTVF9FVkVOVFMuUVVFU1RfQ09OTkVDVElPTiwgKGluZm86YW55KT0+e1xuICAgIGNvbnNvbGUubG9nKCdxdWVzdCBjb25uZWN0aW9uICcsIGluZm8pXG4gICAgbHNjUXVlc3RFdmVudC5lbWl0KExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9DT05ORUNUSU9OLCBpbmZvKVxuICB9KVxuXG4gIHJvb20ub25NZXNzYWdlKExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9FUlJPUiwgKGluZm86YW55KT0+e1xuICAgIGNvbnNvbGUubG9nKCdxdWVzdCBlcnJvciAnLCBpbmZvKVxuICAgIGxzY1F1ZXN0RXZlbnQuZW1pdChMU0NRVUVTVF9FVkVOVFMuUVVFU1RfRVJST1IsIGluZm8pXG4gIH0pXG5cbiAgcm9vbS5vbk1lc3NhZ2UoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX0RBVEEsIChpbmZvOmFueSk9PntcbiAgICBjb25zb2xlLmxvZygndXNlciBxdWVzdCBkYXRhICcsIGluZm8pXG4gICAgaWYoaW5mby51c2VyUXVlc3RJbmZvKXtcbiAgICAgIGxzY1F1ZXN0VXNlckRhdGEuc2V0KGluZm8ucXVlc3RJZCwgaW5mby51c2VyUXVlc3RJbmZvKVxuICAgIH1cbiAgICBsc2NRdWVzdEV2ZW50LmVtaXQoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX0RBVEEsIGluZm8pXG4gIH0pXG5cbiAgcm9vbS5vbk1lc3NhZ2UoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX1NUQVJURUQsIChpbmZvOmFueSk9PntcbiAgICBjb25zb2xlLmxvZygnc3RhcnRlZCBxdWVzdCAnLCBpbmZvKVxuICAgIGxzY1F1ZXN0RXZlbnQuZW1pdChMU0NRVUVTVF9FVkVOVFMuUVVFU1RfU1RBUlRFRCwgaW5mbylcbiAgfSlcblxuICByb29tLm9uTWVzc2FnZShMU0NRVUVTVF9FVkVOVFMuUVVFU1RfQ09NUExFVEUsIChpbmZvOmFueSk9PntcbiAgICBjb25zb2xlLmxvZygnY29tcGxldGUgcXVlc3QgJywgaW5mbylcbiAgICBcbiAgICAvLyBJZiB0aGUgc2VydmVyIHNlbnQgY29tcGxldGUgdXNlciBxdWVzdCBpbmZvLCB1c2UgaXQgZGlyZWN0bHlcbiAgICBpZiAoaW5mby51c2VyUXVlc3RJbmZvKSB7XG4gICAgICBsc2NRdWVzdFVzZXJEYXRhLnNldChpbmZvLnF1ZXN0SWQsIGluZm8udXNlclF1ZXN0SW5mbylcbiAgICB9IFxuICAgIC8vIEZhbGxiYWNrIHRvIG9sZCBiZWhhdmlvciBpZiBzZXJ2ZXIgZG9lc24ndCBzZW5kIGNvbXBsZXRlIGRhdGFcbiAgICBlbHNlIHtcbiAgICAgIGxldCB1c2VyUXVlc3REYXRhID0gbHNjUXVlc3RVc2VyRGF0YS5nZXQoaW5mby5xdWVzdElkKVxuICAgICAgaWYodXNlclF1ZXN0RGF0YSl7XG4gICAgICAgIHVzZXJRdWVzdERhdGEuY29tcGxldGVkID0gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBsc2NRdWVzdEV2ZW50LmVtaXQoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX0NPTVBMRVRFLCBpbmZvKVxuICB9KVxuXG4gIHJvb20ub25NZXNzYWdlKExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9FTkQsIChpbmZvOmFueSk9PntcbiAgICBjb25zb2xlLmxvZygnZW5kZWQgcXVlc3QgJywgaW5mbylcbiAgICBsc2NRdWVzdEV2ZW50LmVtaXQoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX0VORCwgaW5mbylcbiAgfSlcblxuICByb29tLm9uTWVzc2FnZShMU0NRVUVTVF9FVkVOVFMuUVVFU1RfVVBEQVRFLCAoaW5mbzphbnkpPT57XG4gICAgY29uc29sZS5sb2coJ3VwZGF0ZSBxdWVzdCAnLCBpbmZvKVxuICAgIGxzY1F1ZXN0VXNlckRhdGEuc2V0KHVzZXJJZCwgaW5mbylcbiAgICBsc2NRdWVzdEV2ZW50LmVtaXQoTFNDUVVFU1RfRVZFTlRTLlFVRVNUX1VQREFURSwgaW5mbylcbiAgfSlcblxuICByb29tLm9uTWVzc2FnZShMU0NRVUVTVF9FVkVOVFMuUVVFU1RfU1RFUF9DT01QTEVURSwgKGluZm86YW55KT0+e1xuICAgIGNvbnNvbGUubG9nKCdzdGVwIGNvbXBsZXRlIHF1ZXN0ICcsIGluZm8pXG4gICAgXG4gICAgLy8gSWYgdGhlIHNlcnZlciBzZW50IGNvbXBsZXRlIHVzZXIgcXVlc3QgaW5mbywgdXNlIGl0IGRpcmVjdGx5XG4gICAgaWYgKGluZm8udXNlclF1ZXN0SW5mbykge1xuICAgICAgbHNjUXVlc3RVc2VyRGF0YS5zZXQoaW5mby5xdWVzdElkLCBpbmZvLnVzZXJRdWVzdEluZm8pXG4gICAgfVxuICAgIC8vIEZhbGxiYWNrIHRvIG9sZCBiZWhhdmlvciBpZiBzZXJ2ZXIgZG9lc24ndCBzZW5kIGNvbXBsZXRlIGRhdGFcbiAgICBlbHNlIHtcbiAgICAgIGxldCB1c2VyUXVlc3REYXRhID0gbHNjUXVlc3RVc2VyRGF0YS5nZXQoaW5mby5xdWVzdElkKVxuICAgICAgaWYodXNlclF1ZXN0RGF0YSl7XG4gICAgICAgIGxldCBzdGVwID0gdXNlclF1ZXN0RGF0YS5zdGVwcy5maW5kKChzdGVwOmFueSk9PnN0ZXAuc3RlcElkID09PSBpbmZvLnN0ZXBJZClcbiAgICAgICAgaWYoc3RlcCl7XG4gICAgICAgICAgc3RlcC5jb21wbGV0ZWQgPSB0cnVlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgbHNjUXVlc3RFdmVudC5lbWl0KExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9TVEVQX0NPTVBMRVRFLCBpbmZvKVxuICB9KVxuXG4gIHJvb20ub25NZXNzYWdlKExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9UQVNLX0NPTVBMRVRFLCAoaW5mbzphbnkpPT57XG4gICAgY29uc29sZS5sb2coJ3Rhc2sgY29tcGxldGUgcXVlc3QgJywgaW5mbylcbiAgICBcbiAgICAvLyBJZiB0aGUgc2VydmVyIHNlbnQgY29tcGxldGUgdXNlciBxdWVzdCBpbmZvLCB1c2UgaXQgZGlyZWN0bHlcbiAgICBpZiAoaW5mby51c2VyUXVlc3RJbmZvKSB7XG4gICAgICBsc2NRdWVzdFVzZXJEYXRhLnNldChpbmZvLnF1ZXN0SWQsIGluZm8udXNlclF1ZXN0SW5mbylcbiAgICB9IFxuICAgIC8vIEZhbGxiYWNrIHRvIG9sZCBiZWhhdmlvciBpZiBzZXJ2ZXIgZG9lc24ndCBzZW5kIGNvbXBsZXRlIGRhdGFcbiAgICBlbHNlIHtcbiAgICAgIGxldCB1c2VyUXVlc3REYXRhID0gbHNjUXVlc3RVc2VyRGF0YS5nZXQoaW5mby5xdWVzdElkKVxuICAgICAgaWYodXNlclF1ZXN0RGF0YSl7XG4gICAgICAgIGxldCBzdGVwID0gdXNlclF1ZXN0RGF0YS5zdGVwcy5maW5kKChzdGVwOmFueSk9PnN0ZXAuc3RlcElkID09PSBpbmZvLnN0ZXBJZClcbiAgICAgICAgaWYoc3RlcCl7XG4gICAgICAgICAgbGV0IHRhc2sgPSBzdGVwLnRhc2tzLmZpbmQoKHRhc2s6YW55KT0+dGFzay50YXNrSWQgPT09IGluZm8udGFza0lkKVxuICAgICAgICAgIGlmKHRhc2spe1xuICAgICAgICAgICAgdGFzay5jb3VudCsrXG4gICAgICAgICAgICB0YXNrLmNvbXBsZXRlZCA9IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgbHNjUXVlc3RFdmVudC5lbWl0KExTQ1FVRVNUX0VWRU5UUy5RVUVTVF9UQVNLX0NPTVBMRVRFLCBpbmZvKVxuICB9KVxufVxuXG5sZXQgdGltZTpudW1iZXIgPSAwXG5mdW5jdGlvbiBDaGVja1BsYXllclN5c3RlbShkdDpudW1iZXIpe1xuICBpZih0aW1lID4gMCl7XG4gICAgdGltZSAtPSBkdFxuICB9ZWxzZXtcbiAgICBwbGF5ZXIgPSBnZXRQbGF5ZXIoKVxuICAgIGlmKCFwbGF5ZXIpe1xuICAgICAgdGltZSA9IDFcbiAgICB9ZWxzZXtcbiAgICAgIGVuZ2luZS5yZW1vdmVTeXN0ZW0oQ2hlY2tQbGF5ZXJTeXN0ZW0pXG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIENvbm5lY3RRdWVzdFN5c3RlbSgpe1xuICBpZighcGxheWVyKSByZXR1cm5cblxuICBpZihwZW5kaW5nUXVlc3RDb25uZWN0aW9ucy5sZW5ndGggPiAwKXtcbiAgICBsZXQgcGVuZGluZ1F1ZXN0SWQ6c3RyaW5nID0gXCJcIiArIHBlbmRpbmdRdWVzdENvbm5lY3Rpb25zLnNoaWZ0KClcbiAgICBtYWtlUXVlc3RDb25uZWN0aW9uKHBlbmRpbmdRdWVzdElkKVxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1ha2VRdWVzdENvbm5lY3Rpb24ocXVlc3RJZDpzdHJpbmcpe1xuICBjb25zdCByZWFsbSA9IGF3YWl0IGdldFJlYWxtKHt9KVxuXG4gIGNvbnN0IG9wdGlvbnM6YW55ID0ge1xuICAgIHVzZXJJZDogcGxheWVyLnVzZXJJZCxcbiAgICBuYW1lOiBwbGF5ZXIubmFtZSxcbiAgICByZWFsbTogTE9DQUxfQ1JFQVRPUiA/IFwibG9jYWwtdGVzdGluZ1wiIDogcmVhbG0ucmVhbG1JbmZvPy5iYXNlVXJsLFxuICAgIHF1ZXN0SWQ6IHF1ZXN0SWQsXG4gIH1cblxuICBsZXQgY2xpZW50ID0gbmV3IENsaWVudChERUJVRyA/IFxuICAgIHtob3N0bmFtZTonbG9jYWxob3N0Jywgc2VjdXJlOmZhbHNlLCBwb3J0OjUzNTN9IDogXG4gICAge2hvc3RuYW1lOidhbmd6YWFyLXBsYXphLmRjbC1pd2IuY28nLCBwYXRobmFtZTonL3dzJywgc2VjdXJlOnRydWV9XG4gIClcblxuICB0cnkge1xuICAgIGNvbnN0IHJvb206IFJvb20gPSBhd2FpdCBjbGllbnQuam9pbk9yQ3JlYXRlKCdhbmd6YWFyX3F1ZXN0aW5nJywgb3B0aW9ucylcbiAgICBsc2NRdWVzdENvbm5lY3Rpb25zLnNldChxdWVzdElkLCByb29tKVxuICAgIHNldExTQ1F1ZXN0TGlzdGVuZXJzKHJvb20sIHBsYXllci51c2VySWQpXG5cbiAgICByb29tLm9uTGVhdmUoKGNvZGU6bnVtYmVyLCByZWFzb24/OnN0cmluZyk9PntcbiAgICAgIGNvbnNvbGUubG9nKCdsZWZ0IHF1ZXN0IHJvb20nLCBxdWVzdElkLCBjb2RlLCByZWFzb24pXG4gICAgICAgIGxzY1F1ZXN0RXZlbnQuZW1pdChMU0NRVUVTVF9FVkVOVFMuUVVFU1RfRElTQ09OTkVDVCwge3F1ZXN0SWQsIGNvZGUsIHJlYXNvbn0pXG4gICAgfSlcbiAgICByZXR1cm4gcm9vbVxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY29ubmVjdGluZyB0byBMU0MgUXVlc3QgU3lzdGVtJywgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5cbi8qKlxuICogXG4gKiBAcGFyYW0gcXVlc3RJZCBcbiAqIEBwYXJhbSBwb3NpdGlvbiBcbiAqIEBwYXJhbSB1cGRhdGVJbnRlcnZhbCBcbiAqIEBwYXJhbSBsaW1pdCBcbiAqIEBwYXJhbSBvcmRlciBcbiAqIEBwYXJhbSBzb3J0QnkgXG4gKiBAcGFyYW0gY29tcGxldGVkIFxuICogQHBhcmFtIHNob3dCYWNrZ3JvdW5kXG4gKiBAcGFyYW0gdGl0bGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIExTQ1F1ZXN0TGVhZGVyYm9hcmQoXG4gIHF1ZXN0SWQ6c3RyaW5nLCBcbiAgdHJhbnNmb3JtOlRyYW5zZm9ybVR5cGUsIFxuICB1cGRhdGVJbnRlcnZhbDpudW1iZXIsXG4gIGxpbWl0Om51bWJlcixcbiAgb3JkZXI6ICdhc2MnIHwgJ2FzYycgPSAnYXNjJyxcbiAgc29ydEJ5OnN0cmluZyA9ICdlbGFwc2VkVGltZScsXG4gIGNvbXBsZXRlZDpib29sZWFuID0gdHJ1ZSxcbiAgc2hvd0JhY2tncm91bmQ6Ym9vbGVhbiA9IHRydWUsXG4gIHRpdGxlOnN0cmluZyA9IFwiTGVhZGVyYm9hcmRcIlxuICApe1xuICAgIFxuICBsZXQgbGVhZGVyYm9hcmQgPSBlbmdpbmUuYWRkRW50aXR5KClcbiAgVHJhbnNmb3JtLmNyZWF0ZShsZWFkZXJib2FyZCwgdHJhbnNmb3JtKVxuICBcbiAgLy8gUm93IGRpbWVuc2lvbnNcbiAgY29uc3Qgcm93V2lkdGggPSAzXG4gIGNvbnN0IHJvd0hlaWdodCA9IDAuNFxuICBcbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGZvcm1hdCB0aGUgc2NvcmUgdHlwZSBmb3IgZGlzcGxheVxuICBmdW5jdGlvbiBmb3JtYXRTY29yZVR5cGUodHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAodHlwZSA9PT0gJ2VsYXBzZWRUaW1lJykgcmV0dXJuICdUaW1lJztcbiAgICByZXR1cm4gdHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSk7IC8vIENhcGl0YWxpemUgZmlyc3QgbGV0dGVyXG4gIH1cbiAgXG4gIC8vIENyZWF0ZSB0aXRsZVxuICBjb25zdCB0aXRsZUVudGl0eSA9IGVuZ2luZS5hZGRFbnRpdHkoKVxuICBUcmFuc2Zvcm0uY3JlYXRlKHRpdGxlRW50aXR5LCB7XG4gICAgcGFyZW50OiBsZWFkZXJib2FyZCxcbiAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUoMCwgMC42LCAwKVxuICB9KVxuICBUZXh0U2hhcGUuY3JlYXRlKHRpdGxlRW50aXR5LCB7XG4gICAgdGV4dDogdGl0bGUsXG4gICAgZm9udFNpemU6IDIuNSxcbiAgICB0ZXh0QWxpZ246IFRleHRBbGlnbk1vZGUuVEFNX01JRERMRV9DRU5URVJcbiAgfSlcbiAgXG4gIC8vIFJvdyBwb3NpdGlvbnMgKGNlbnRlcmVkKVxuICBjb25zdCBsZWZ0UG9zID0gLTEuMlxuICBjb25zdCBjZW50ZXJQb3MgPSAwXG4gIGNvbnN0IHJpZ2h0UG9zID0gMS4yXG4gIFxuICAvLyBDcmVhdGUgaGVhZGVyIHJvd1xuICBjb25zdCBoZWFkZXJFbnRpdHkgPSBlbmdpbmUuYWRkRW50aXR5KClcbiAgVHJhbnNmb3JtLmNyZWF0ZShoZWFkZXJFbnRpdHksIHtcbiAgICBwYXJlbnQ6IGxlYWRlcmJvYXJkLFxuICAgIHBvc2l0aW9uOiBWZWN0b3IzLmNyZWF0ZSgwLCAwLjIsIDApXG4gIH0pXG4gIFxuICAvLyBIZWFkZXIgYmFja2dyb3VuZFxuICBjb25zdCBoZWFkZXJCZ0VudGl0eSA9IGVuZ2luZS5hZGRFbnRpdHkoKVxuICBUcmFuc2Zvcm0uY3JlYXRlKGhlYWRlckJnRW50aXR5LCB7XG4gICAgcGFyZW50OiBoZWFkZXJFbnRpdHksXG4gICAgcG9zaXRpb246IFZlY3RvcjMuY3JlYXRlKDAsIDAsIDAuMDMpLFxuICAgIHNjYWxlOiBWZWN0b3IzLmNyZWF0ZShyb3dXaWR0aCwgcm93SGVpZ2h0LCAxKVxuICB9KVxuICBNZXNoUmVuZGVyZXIuc2V0UGxhbmUoaGVhZGVyQmdFbnRpdHkpXG4gIE1hdGVyaWFsLnNldFBick1hdGVyaWFsKGhlYWRlckJnRW50aXR5LCB7XG4gICAgYWxiZWRvQ29sb3I6IENvbG9yNC5jcmVhdGUoMC8yNTUsIDI1NS8yNTUsIDIxMy8yNTUsMSlcbiAgfSlcbiAgXG4gIC8vIEhlYWRlciBsYWJlbHNcbiAgY29uc3QgcmFua0hlYWRlckVudGl0eSA9IGVuZ2luZS5hZGRFbnRpdHkoKVxuICBUcmFuc2Zvcm0uY3JlYXRlKHJhbmtIZWFkZXJFbnRpdHksIHtcbiAgICBwYXJlbnQ6IGhlYWRlckVudGl0eSxcbiAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUobGVmdFBvcywgMCwgMC4wMilcbiAgfSlcbiAgVGV4dFNoYXBlLmNyZWF0ZShyYW5rSGVhZGVyRW50aXR5LCB7XG4gICAgdGV4dDogXCJSYW5rXCIsXG4gICAgZm9udFNpemU6IDEuNSxcbiAgICB0ZXh0QWxpZ246IFRleHRBbGlnbk1vZGUuVEFNX01JRERMRV9DRU5URVJcbiAgfSlcbiAgXG4gIGNvbnN0IG5hbWVIZWFkZXJFbnRpdHkgPSBlbmdpbmUuYWRkRW50aXR5KClcbiAgVHJhbnNmb3JtLmNyZWF0ZShuYW1lSGVhZGVyRW50aXR5LCB7XG4gICAgcGFyZW50OiBoZWFkZXJFbnRpdHksXG4gICAgcG9zaXRpb246IFZlY3RvcjMuY3JlYXRlKGNlbnRlclBvcyAtIDAuNCwgMCwgMC4wMilcbiAgfSlcbiAgVGV4dFNoYXBlLmNyZWF0ZShuYW1lSGVhZGVyRW50aXR5LCB7XG4gICAgdGV4dDogXCJQbGF5ZXJcIixcbiAgICBmb250U2l6ZTogMS41LFxuICAgIHRleHRBbGlnbjogVGV4dEFsaWduTW9kZS5UQU1fTUlERExFX0xFRlRcbiAgfSlcbiAgXG4gIGNvbnN0IHNjb3JlSGVhZGVyRW50aXR5ID0gZW5naW5lLmFkZEVudGl0eSgpXG4gIFRyYW5zZm9ybS5jcmVhdGUoc2NvcmVIZWFkZXJFbnRpdHksIHtcbiAgICBwYXJlbnQ6IGhlYWRlckVudGl0eSxcbiAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUocmlnaHRQb3MsIDAsIDAuMDIpXG4gIH0pXG4gIFRleHRTaGFwZS5jcmVhdGUoc2NvcmVIZWFkZXJFbnRpdHksIHtcbiAgICB0ZXh0OiBmb3JtYXRTY29yZVR5cGUoc29ydEJ5KSxcbiAgICBmb250U2l6ZTogMS41LFxuICAgIHRleHRBbGlnbjogVGV4dEFsaWduTW9kZS5UQU1fTUlERExFX0NFTlRFUlxuICB9KVxuICBcbiAgLy8gQXJyYXkgdG8gc3RvcmUgcmVmZXJlbmNlcyB0byBhbGwgbGVhZGVyYm9hcmQgZW50aXRpZXNcbiAgY29uc3QgbGVhZGVyYm9hcmRSb3dzOiBBcnJheTx7XG4gICAgcmFuazogbnVtYmVyLFxuICAgIHJvd0VudGl0eTogRW50aXR5LFxuICAgIGJhY2tncm91bmRFbnRpdHk6IEVudGl0eSxcbiAgICByYW5rRW50aXR5OiBFbnRpdHksXG4gICAgcHJvZmlsZUVudGl0eTogRW50aXR5LFxuICAgIG5hbWVFbnRpdHk6IEVudGl0eSxcbiAgICBzY29yZUVudGl0eTogRW50aXR5XG4gIH0+ID0gW11cblxuICAvLyBDcmVhdGUgcGxhY2Vob2xkZXIgcm93c1xuICBmb3IobGV0IGkgPSAwOyBpIDwgbGltaXQ7IGkrKyl7XG4gICAgLy8gQ3JlYXRlIHJvdyBjb250YWluZXIgZW50aXR5XG4gICAgY29uc3Qgcm93RW50aXR5ID0gZW5naW5lLmFkZEVudGl0eSgpXG4gICAgVHJhbnNmb3JtLmNyZWF0ZShyb3dFbnRpdHksIHtcbiAgICAgIHBhcmVudDogbGVhZGVyYm9hcmQsXG4gICAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUoMCwgLWkgKiAwLjUgLSAwLjIsIDApXG4gICAgfSlcbiAgXG4gICAgLy8gQ3JlYXRlIGJhY2tncm91bmQgZW50aXR5XG4gICAgY29uc3QgYmFja2dyb3VuZEVudGl0eSA9IGVuZ2luZS5hZGRFbnRpdHkoKVxuICAgIGlmIChzaG93QmFja2dyb3VuZCkge1xuICAgICAgVHJhbnNmb3JtLmNyZWF0ZShiYWNrZ3JvdW5kRW50aXR5LCB7XG4gICAgICAgIHBhcmVudDogcm93RW50aXR5LFxuICAgICAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUoMCwgMCwgMC4wMSksXG4gICAgICAgIHNjYWxlOiBWZWN0b3IzLmNyZWF0ZShyb3dXaWR0aCwgcm93SGVpZ2h0LCAxKVxuICAgICAgfSlcbiAgICAgIE1lc2hSZW5kZXJlci5zZXRQbGFuZShiYWNrZ3JvdW5kRW50aXR5KVxuICAgICAgTWF0ZXJpYWwuc2V0UGJyTWF0ZXJpYWwoYmFja2dyb3VuZEVudGl0eSwge1xuICAgICAgICBhbGJlZG9Db2xvcjogaSAlIDIgPT09IDAgPyBcbiAgICAgICAgICBDb2xvcjQuY3JlYXRlKDE4LzI1NSwgMjMvMjU1LDM3LzI1NSwxKSA6XG4gICAgICAgICAgQ29sb3I0LmNyZWF0ZSgyNi8yNTUsMzQvMjU1LCA1My8yNTUsIDEpXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBUcmFuc2Zvcm0uY3JlYXRlKGJhY2tncm91bmRFbnRpdHksIHtcbiAgICAgICAgcGFyZW50OiByb3dFbnRpdHksXG4gICAgICAgIHNjYWxlOiBWZWN0b3IzLlplcm8oKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcmFuayBlbnRpdHkgKCMxLCAjMiwgZXRjLilcbiAgICBjb25zdCByYW5rRW50aXR5ID0gZW5naW5lLmFkZEVudGl0eSgpXG4gICAgVHJhbnNmb3JtLmNyZWF0ZShyYW5rRW50aXR5LCB7XG4gICAgICBwYXJlbnQ6IHJvd0VudGl0eSxcbiAgICAgIHBvc2l0aW9uOiBWZWN0b3IzLmNyZWF0ZShsZWZ0UG9zLCAwLCAwKVxuICAgIH0pXG4gICAgVGV4dFNoYXBlLmNyZWF0ZShyYW5rRW50aXR5LCB7dGV4dDpgIyR7aSArIDF9YCwgZm9udFNpemU6MS41fSlcblxuICAgIC8vIENyZWF0ZSBwcm9maWxlIGltYWdlIGVudGl0eVxuICAgIGNvbnN0IHByb2ZpbGVFbnRpdHkgPSBlbmdpbmUuYWRkRW50aXR5KClcbiAgICBUcmFuc2Zvcm0uY3JlYXRlKHByb2ZpbGVFbnRpdHksIHtcbiAgICAgIHBhcmVudDogcm93RW50aXR5LFxuICAgICAgcG9zaXRpb246IFZlY3RvcjMuY3JlYXRlKGNlbnRlclBvcyAtIDAuOCwgMCwgMCksXG4gICAgICBzY2FsZTogVmVjdG9yMy5jcmVhdGUoMC4zLDAuMywwLjMpXG4gICAgfSlcbiAgICBNZXNoUmVuZGVyZXIuc2V0UGxhbmUocHJvZmlsZUVudGl0eSlcbiAgICBNYXRlcmlhbC5zZXRQYnJNYXRlcmlhbChwcm9maWxlRW50aXR5LCB7XG4gICAgICB0ZXh0dXJlOiBNYXRlcmlhbC5UZXh0dXJlLkF2YXRhcih7XG4gICAgICAgIHVzZXJJZDogJycsXG4gICAgICB9KSxcbiAgICB9KVxuXG4gICAgLy8gQ3JlYXRlIG5hbWUgZW50aXR5XG4gICAgY29uc3QgbmFtZUVudGl0eSA9IGVuZ2luZS5hZGRFbnRpdHkoKVxuICAgIFRyYW5zZm9ybS5jcmVhdGUobmFtZUVudGl0eSwge1xuICAgICAgcGFyZW50OiByb3dFbnRpdHksXG4gICAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUoY2VudGVyUG9zIC0gMC40LCAwLCAwKVxuICAgIH0pXG4gICAgVGV4dFNoYXBlLmNyZWF0ZShuYW1lRW50aXR5LCB7dGV4dDpgTmFtZWAsIGZvbnRTaXplOjEuNSwgIHRleHRBbGlnbjogVGV4dEFsaWduTW9kZS5UQU1fTUlERExFX0xFRlR9KVxuXG4gICAgLy8gQ3JlYXRlIHNjb3JlIGVudGl0eVxuICAgIGNvbnN0IHNjb3JlRW50aXR5ID0gZW5naW5lLmFkZEVudGl0eSgpXG4gICAgVHJhbnNmb3JtLmNyZWF0ZShzY29yZUVudGl0eSwge1xuICAgICAgcGFyZW50OiByb3dFbnRpdHksXG4gICAgICBwb3NpdGlvbjogVmVjdG9yMy5jcmVhdGUocmlnaHRQb3MsIDAsIDApXG4gICAgfSlcbiAgICBUZXh0U2hhcGUuY3JlYXRlKHNjb3JlRW50aXR5LCB7dGV4dDpgU2NvcmVgLCBmb250U2l6ZToxLjV9KVxuXG4gICAgLy8gU3RvcmUgcmVmZXJlbmNlcyB0byBhbGwgZW50aXRpZXNcbiAgICBsZWFkZXJib2FyZFJvd3MucHVzaCh7XG4gICAgICByYW5rOiBpICsgMSxcbiAgICAgIHJvd0VudGl0eSxcbiAgICAgIGJhY2tncm91bmRFbnRpdHksXG4gICAgICByYW5rRW50aXR5LFxuICAgICAgcHJvZmlsZUVudGl0eSxcbiAgICAgIG5hbWVFbnRpdHksXG4gICAgICBzY29yZUVudGl0eVxuICAgIH0pXG4gIH1cblxuICBsZXQgdGltZSA9IDBcbiAgZnVuY3Rpb24gbGVhZGVyYm9hcmRVcGRhdGUoZHQ6bnVtYmVyKXtcbiAgICBpZih0aW1lID4gMCl7XG4gICAgICB0aW1lIC09IGR0XG4gICAgfWVsc2V7XG4gICAgICB0aW1lID0gdXBkYXRlSW50ZXJ2YWxcbiAgICAgIHVwZGF0ZUxTQ1F1ZXN0TGVhZGVyYm9hcmQoKVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxTQ1F1ZXN0TGVhZGVyYm9hcmQoKXtcbiAgICB0cnl7XG4gICAgICAvLyBHZXQgY3VycmVudCBwbGF5ZXIgaW5mb3JtYXRpb24gZmlyc3RcbiAgICAgIGNvbnN0IHBsYXllckRhdGEgPSBnZXRQbGF5ZXIoKTtcbiAgICAgIGNvbnN0IHBsYXllcklEID0gcGxheWVyRGF0YSA/IHBsYXllckRhdGEudXNlcklkIDogJyc7XG4gICAgICBjb25zdCBwbGF5ZXJOYW1lID0gcGxheWVyRGF0YT8ubmFtZSB8fCAnWW91JztcbiAgICAgIFxuICAgICAgLy8gRGVmaW5lIHRoZSB1c2VyIGRhdGEgaW50ZXJmYWNlXG4gICAgICBpbnRlcmZhY2UgVXNlckRhdGEge1xuICAgICAgICB1c2VySWQ6IHN0cmluZztcbiAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICBlbGFwc2VkVGltZTogbnVtYmVyO1xuICAgICAgICBjb21wbGV0ZWQ6IGJvb2xlYW47XG4gICAgICAgIFtrZXk6IHN0cmluZ106IGFueTsgLy8gQWxsb3cgZm9yIGR5bmFtaWMgcHJvcGVydGllcyAvL1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBHZXQgbGVhZGVyYm9hcmQgZGF0YSBmcm9tIEFQSVxuICAgICAgbGV0IHBhcmFtcyA9IFtgY29tcGxldGVkPSR7Y29tcGxldGVkfWAsIGBvcmRlcj0ke29yZGVyfWAsIGBsaW1pdD0ke2xpbWl0fWAsIGBzb3J0Qnk9JHtzb3J0Qnl9YF1cbiAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjUzNTMvYXBpL3F1ZXN0cy8ke3F1ZXN0SWR9L3VzZXJzP2AgKyBwYXJhbXMuam9pbignJicpKSBcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgICAvLyBjb25zb2xlLmxvZygnbGVhZGVyYm9hcmQgZGF0YTonLCBkYXRhKTtcbiAgICAgIFxuICAgICAgLy8gVXBkYXRlIGxlYWRlcmJvYXJkIHdpdGggZGF0YVxuICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxlYWRlcmJvYXJkUm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByb3cgPSBsZWFkZXJib2FyZFJvd3NbaV1cbiAgICAgICAgY29uc3Qgcm93RGF0YSA9IGRhdGFbaV1cbiAgICAgICAgXG4gICAgICAgIGlmIChyb3dEYXRhKSB7XG4gICAgICAgICAgLy8gU2hvdyB0aGlzIHJvdyBhbmQgdXBkYXRlIHdpdGggdXNlciBkYXRhXG4gICAgICAgICAgaWYgKCFUcmFuc2Zvcm0uaGFzKHJvdy5yb3dFbnRpdHkpKSBjb250aW51ZVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIE1ha2Ugcm93IHZpc2libGVcbiAgICAgICAgICBUcmFuc2Zvcm0uZ2V0TXV0YWJsZShyb3cucm93RW50aXR5KS5zY2FsZSA9IFZlY3RvcjMuY3JlYXRlKDEsIDEsIDEpXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gT25seSB1cGRhdGUgYmFja2dyb3VuZCBpZiBpdCdzIGVuYWJsZWRcbiAgICAgICAgICBpZiAoc2hvd0JhY2tncm91bmQpIHtcbiAgICAgICAgICAgIFRyYW5zZm9ybS5nZXRNdXRhYmxlKHJvdy5iYWNrZ3JvdW5kRW50aXR5KS5zY2FsZSA9IFZlY3RvcjMuY3JlYXRlKHJvd1dpZHRoLCByb3dIZWlnaHQsIDEpXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNldCB1c2VyIHJhbmsgKCMxLCAjMiwgZXRjLilcbiAgICAgICAgICBjb25zdCByYW5rVGV4dCA9IGAjJHtpICsgMX1gXG4gICAgICAgICAgVGV4dFNoYXBlLmdldE11dGFibGUocm93LnJhbmtFbnRpdHkpLnRleHQgPSByYW5rVGV4dFxuXG4gICAgICAgICAgTWF0ZXJpYWwuc2V0UGJyTWF0ZXJpYWwocm93LnByb2ZpbGVFbnRpdHksIHtcbiAgICAgICAgICAgIHRleHR1cmU6IE1hdGVyaWFsLlRleHR1cmUuQXZhdGFyKHtcbiAgICAgICAgICAgICAgdXNlcklkOiByb3dEYXRhLnVzZXJJZCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2V0IHVzZXIgbmFtZVxuICAgICAgICAgIGNvbnN0IG5hbWUgPSByb3dEYXRhLm5hbWUgfHwgJ0Fub255bW91cydcbiAgICAgICAgICBUZXh0U2hhcGUuZ2V0TXV0YWJsZShyb3cubmFtZUVudGl0eSkudGV4dCA9IG5hbWVcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTZXQgdXNlciBzY29yZSAodGltZSwgcHJvZ3Jlc3MsIGV0Yy4pXG4gICAgICAgICAgbGV0IHNjb3JlVGV4dCA9ICcnXG4gICAgICAgICAgaWYgKHNvcnRCeSA9PT0gJ2VsYXBzZWRUaW1lJykge1xuICAgICAgICAgICAgLy8gRm9ybWF0IHRpbWUgZGlzcGxheVxuICAgICAgICAgICAgY29uc3QgbXMgPSByb3dEYXRhLmVsYXBzZWRUaW1lICogMTAwMFxuICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IobXMgLyAxMDAwKVxuICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKVxuICAgICAgICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKG1pbnV0ZXMgLyA2MClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGhvdXJzID4gMCkge1xuICAgICAgICAgICAgICBzY29yZVRleHQgPSBgJHtob3Vyc31oICR7bWludXRlcyAlIDYwfW1gXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1pbnV0ZXMgPiAwKSB7XG4gICAgICAgICAgICAgIHNjb3JlVGV4dCA9IGAke21pbnV0ZXN9bSAke3NlY29uZHMgJSA2MH1zYFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2NvcmVUZXh0ID0gYCR7c2Vjb25kc31zYFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3Igb3RoZXIgc2NvcmUgdHlwZXNcbiAgICAgICAgICAgIHNjb3JlVGV4dCA9IHJvd0RhdGFbc29ydEJ5XT8udG9TdHJpbmcoKSB8fCAnMCdcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBUZXh0U2hhcGUuZ2V0TXV0YWJsZShyb3cuc2NvcmVFbnRpdHkpLnRleHQgPSBzY29yZVRleHRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBIaWRlIHRoaXMgcm93IGFzIHRoZXJlJ3Mgbm8gZGF0YVxuICAgICAgICAgIGlmIChUcmFuc2Zvcm0uaGFzKHJvdy5yb3dFbnRpdHkpKSB7XG4gICAgICAgICAgICBUcmFuc2Zvcm0uZ2V0TXV0YWJsZShyb3cucm93RW50aXR5KS5zY2FsZSA9IFZlY3RvcjMuWmVybygpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIE9ubHkgdXBkYXRlIGJhY2tncm91bmQgaWYgaXQncyBlbmFibGVkXG4gICAgICAgICAgICBpZiAoc2hvd0JhY2tncm91bmQpIHtcbiAgICAgICAgICAgICAgVHJhbnNmb3JtLmdldE11dGFibGUocm93LmJhY2tncm91bmRFbnRpdHkpLnNjYWxlID0gVmVjdG9yMy5aZXJvKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoKGU6YW55KSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyb3IgdXBkYXRpbmcgcXVlc3QgbGVhZGVyYm9hcmQnLCBlKVxuICAgIH1cbiAgfVxuXG4gIGVuZ2luZS5hZGRTeXN0ZW0obGVhZGVyYm9hcmRVcGRhdGUpXG5cbiAgLy8gUmVhY3RFY3NSZW5kZXJlci5zZXRVaVJlbmRlcmVyKHVpQ29tcG9uZW50KVxufSJdfQ==